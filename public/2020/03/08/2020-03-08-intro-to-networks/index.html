<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>A Brief Introduction to Network Analysis with R &middot; G</title>
        <meta name="description" content="Using the tidygraph, ggraph, and networkD3 packages">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.59.1" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="../../../../dist/styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                  
                        <a href="../../../../" class="footer-links-kudos"> <img src="../../../../images/logo.png" width="350" height="350"></a>
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="../../../../">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="../../../../page/about/">About</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">A Brief Introduction to Network Analysis with R</h1>
    
        <p class="post-description" itemprop="description">Using the tidygraph, ggraph, and networkD3 packages</p>
    
    <p class="post-date post-line">
        <span>Published <time datetime="2020-03-08" itemprop="datePublished">Sun, Mar 8, 2020</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://google.com/&#43;XXX" itemprop="url" rel="author">G</a>
            </span>
        </span>
    </p>
    
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    
<script src="../../../../rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="../../../../rmarkdown-libs/d3/d3.min.js"></script>
<script src="../../../../rmarkdown-libs/forceNetwork-binding/forceNetwork.js"></script>


<p>In this post I will you walk through the basics of working with network objects in R. We will first create a simple network as an example, manipulate it using tidygraph’s very clean framework, and then do some simple plotting using ggraph and networkD3. Then we will step it up a bit with a larger dataset and calculate some network metrics.</p>
<p>My goal for this post is to show you how the manipulation steps from the simple example transfer over to the more complex one. And how these packages allow you to easily carry out a lot of complex calculations with very little code.</p>
<div id="libraries-needed" class="section level1">
<h1>Libraries needed:</h1>
<pre class="r"><code>library(tidygraph) # Network manipulation
library(magrittr)  # Data wrangling
library(tidyverse) # Data wrangling
library(ggraph)    # Static network plotting
library(patchwork) # Arrainging plots
library(networkD3) # Interactive network plotting</code></pre>
</div>
<div id="lets-make-a-simple-graph" class="section level1">
<h1>Lets make a simple graph!</h1>
<p>Making networks is way easier than it sounds. All it takes is two simple vectors of equal length, then just bind them into a dataframe.</p>
<pre class="r"><code>from  &lt;- c(1, 1, 2, 3, 4, 5)

to    &lt;- c(2, 3, 4, 4 ,5, 6)

# combine the from and to vectors into a simple dataframe 
basic &lt;- tibble(from, to)</code></pre>
<p>So what we have is what is called an “edge list” which is essentially a dataframe that says “there is a connection from node 1 to node 2, anther from node 1 to node 3.” And on and on…</p>
<pre><code>## # A tibble: 6 x 2
##    from    to
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2
## 2     1     3
## 3     2     4
## 4     3     4
## 5     4     5
## 6     5     6</code></pre>
<p>Now lets use networkD3’s <code>simpleNetwork()</code> function to quickly make an interactive plot so we can visualize our simple network. The nice thing about this function is that it only requires an edge list. There is no wrangling needed. Go on, click and drag a node!</p>
<pre class="r"><code>networkD3::simpleNetwork(basic)</code></pre>
<p><div id="htmlwidget-1" style="width:672px;height:480px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"links":{"source":[0,0,1,2,3,4],"target":[1,2,3,3,4,5],"value":[1,1,1,1,1,1],"colour":["#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["1","2","3","4","5","6"],"group":[1,1,1,1,1,1],"nodesize":[8,8,8,8,8,8]},"options":{"NodeID":"name","Group":"group","colourScale":"d3.scaleOrdinal(['#3182bd'])","fontSize":7,"fontFamily":"serif","clickTextSize":17.5,"linkDistance":50,"linkWidth":"'1.5px'.toString()","charge":-30,"opacity":0.6,"zoom":false,"legend":false,"arrows":false,"nodesize":true,"radiusCalculation":"d.nodesize","bounded":false,"opacityNoHover":1,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
This an awesome function, but the functionality and customization is a bit limited. We will use another function from this package to leverage more customization for our visualization later on in the post.</p>
</div>
<div id="converting-the-edge-list-to-a-tidygraph-object." class="section level1">
<h1>Converting the edge list to a tidygraph object.</h1>
<p>In order to convert the edge list into a tidygraph object we use <code>tidygraph::as_tbl_graph()</code>.</p>
<pre class="r"><code>tidy_basic &lt;- basic %&gt;% 
  as_tbl_graph()</code></pre>
</div>
<div id="what-is-a-tidygraph-object" class="section level1">
<h1>What is a tidygraph object?</h1>
<p>The tidygraph object is two dataframes connected. The nodes (each point) and edge (each connection) and it can operate the same as an igraph object. It makes your data very readable, but also allows it to function in the world of igraph.</p>
<pre><code>## # A tbl_graph: 6 nodes and 6 edges
## #
## # A directed acyclic simple graph with 1 component
## #
## # Node Data: 6 x 1 (active)
##   name 
##   &lt;chr&gt;
## 1 1    
## 2 2    
## 3 3    
## 4 4    
## 5 5    
## 6 6    
## #
## # Edge Data: 6 x 2
##    from    to
##   &lt;int&gt; &lt;int&gt;
## 1     1     2
## 2     1     3
## 3     2     4
## # … with 3 more rows</code></pre>
<p>In order to manipulate the <code>tbl_graph</code> we need to tell R which of the two data frames we want to operate on. This is done with <code>activate(nodes)</code> or <code>activate(edges)</code>. I will show how we would name each node with a letter, and give each edge a random amount of transparency. Note the activate call between the operations.</p>
<pre class="r"><code>tidy_basic_manipulated &lt;- tidy_basic %&gt;% 
  activate(nodes) %&gt;%              # tell tidygraph we want to work on the modes dataframe
  mutate(id = letters[1:6]) %&gt;%    # adding an id column for each node a - f
  activate(edges) %&gt;%              # tell tidygraph we want to work on the edge dataframe
  mutate(alpha = runif(6, min = 0, max = 1)) # give each edge a random transparency value</code></pre>
<p>Now let’s take a quick look at the columns we added to the plot. We can see the new alpha column added to the edges, and the id column added to the nodes. Also because the edges were the last thing I activated they are still active here.</p>
<pre><code>## # A tbl_graph: 6 nodes and 6 edges
## #
## # A directed acyclic simple graph with 1 component
## #
## # Edge Data: 6 x 3 (active)
##    from    to  alpha
##   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
## 1     1     2 0.124 
## 2     1     3 0.234 
## 3     2     4 0.518 
## 4     3     4 0.618 
## 5     4     5 0.330 
## 6     5     6 0.0179
## #
## # Node Data: 6 x 2
##   name  id   
##   &lt;chr&gt; &lt;chr&gt;
## 1 1     a    
## 2 2     b    
## 3 3     c    
## # … with 3 more rows</code></pre>
<p>#Some quick plotting using ggraph.
We will delve into this a bit more later so for now lets make a basic plot. In order to use ggraph we need to specify the layout, (I will explain this later) and we need to give both the nodes and edges a <code>geom_</code>.</p>
<pre class="r"><code>ggraph(tidy_basic_manipulated, layout = &#39;sugiyama&#39;)+
  geom_edge_link  (aes(alpha = alpha)) +          # plot the links between nodes
  geom_node_point (aes(color = id)) +             # add color to the nodes
  geom_node_text  (aes(label = id), repel = TRUE) # add the names of each node as a label</code></pre>
<p><img src="../../../../post/2020-03-08-intro-to-networks_files/figure-html/unnamed-chunk-9-1.png" width="672" />
Super! We created a simple edge list, made it into a tidy graph object, manipulated it, then plotted it. Next we will step up the complexity with a bigger dataframe and by using some network analysis calculations. I hope I can prove that it is about as simple as what we just did.</p>
</div>
<div id="a-slightly-more-complex-example" class="section level1">
<h1>A slightly more complex example</h1>
<p>Lets look a the highschool dataset from <code>ggraph</code>. Now this data has a yearly component, we’ll get to that part but for now lets stick to one year for simplicity.</p>
<pre class="r"><code>hs_tidy &lt;- highschool %&gt;% 
  filter(year == 1957) %&gt;% # remove the time component for this example
  select(-year) %&gt;% 
  as_tbl_graph() # turn the edge list into a tbl_graph</code></pre>
<p>And lets plot it real quick so we know what we are dealing with.</p>
<pre class="r"><code>ggraph(hs_tidy, layout = &quot;stress&quot;) +
  geom_node_point() +
  geom_edge_link()</code></pre>
<p><img src="../../../../post/2020-03-08-intro-to-networks_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Now that we have our data into tidygraph’s tbl_graph object we can easily calculate many statistical measures for each node edge easily combining <code>activate()</code> and <code>mutate()</code>. There are quite a few centrality measures from igraph and all are fully supported with tidygraph, a full list can be found <a href="https://rdrr.io/cran/tidygraph/man/centrality.html">HERE</a>.</p>
<pre class="r"><code>hs_manipulated &lt;- hs_tidy %&gt;% 
  activate(nodes) %&gt;% 
  mutate(  
    # calculate various centrality measures
    central_alpha  = centrality_alpha(), 
    central_degree = centrality_degree(),
    
    # calculate various grouping/clustering measures
    components     = as.factor(group_components()), 
    walktrap       = as.factor(group_walktrap()) 
    
  ) %&gt;%    
  activate(edges) %&gt;% 
  mutate(  # calculate edge centrality
    weight =  centrality_edge_betweenness()
  )</code></pre>
<p>Let’s take a look at our new metrics</p>
<pre><code>## # A tbl_graph: 70 nodes and 243 edges
## #
## # A directed simple graph with 2 components
## #
## # Node Data: 70 x 5 (active)
##   name  central_alpha central_degree components walktrap
##   &lt;chr&gt;         &lt;dbl&gt;          &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;   
## 1 1             1.                 5 1          1       
## 2 2             1                  2 1          1       
## 3 3             1                  2 1          1       
## 4 4            -1.33               4 2          2       
## 5 5            -0.333              2 2          2       
## 6 6            -7.5                3 1          1       
## # … with 64 more rows
## #
## # Edge Data: 243 x 3
##    from    to weight
##   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
## 1     1    13   1.83
## 2     1    14   8.33
## 3     1    20   2.98
## # … with 240 more rows</code></pre>
<p>Let’s plot it and specify aesthetics based off the metrics we calculated.</p>
<pre class="r"><code>ggraph(hs_manipulated, layout = &#39;stress&#39;) +
  geom_edge_link (aes(alpha = weight)) +
  geom_node_point(aes(color = walktrap,
                      size = central_alpha)) </code></pre>
<p><img src="../../../../post/2020-03-08-intro-to-networks_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Now lets play around a bit with some of the functionality of ggraph. This package is made to behave a lot like ggplot2. However, one key difference is the layout argument. This tells ggraph what algorithm to use when laying out the nodes. You can really deep down this rabbit hole. If you want to you can start creating your own layouts with the <a href="https://cran.r-project.org/web/packages/particles/vignettes/intro.html">particles package</a>.</p>
<p>Or, you can just do what I do and choose random ones until you get one you like.</p>
<pre class="r"><code>a &lt;- ggraph(hs_manipulated, layout = &quot;kk&quot;) +
  geom_node_point(aes(color = components)) +
  labs(title = &quot;Layout stays the same&quot;,
       subtitle = &quot;Nodes don&#39;t move&quot;)

b &lt;- ggraph(hs_manipulated, layout = &quot;kk&quot;) +
  geom_edge_link() +
  geom_node_point(aes(color = components)) 
  

c &lt;- ggraph(hs_manipulated, layout = &quot;kk&quot;) +
  geom_edge_hive() +
  geom_node_point(aes(color = components)) 


d &lt;- ggraph(hs_manipulated, layout = &quot;linear&quot;) +
  geom_edge_arc() +
  geom_node_point(aes(color = components)) +
  labs(title = &quot;Change in layout&quot;,
       subtitle = &quot;Move the nodes&quot;)

e &lt;- ggraph(hs_manipulated, layout = &quot;linear&quot;, circular = TRUE) +
  geom_edge_arc() +
  geom_node_point(aes(color = components)) 
  

f &lt;- ggraph(hs_manipulated, layout = &quot;mds&quot;) +
  geom_edge_link() +
  geom_node_point(aes(color = components)) 


# laying out the plots with patchwork
plots_compared &lt;- ((a/b/c) | (d/e/f)) +
  plot_layout(guides = &#39;collect&#39;)  +  
  plot_annotation(tag_levels = &#39;a&#39;)

plots_compared </code></pre>
<p><img src="../../../../post/2020-03-08-intro-to-networks_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Now that you have mastered static plotting, lets take another look at the interactive plotting we can do with networkD3</p>
</div>
<div id="use-networkd3-to-make-a-more-detailed-plot" class="section level1">
<h1>Use networkD3 to make a more detailed plot</h1>
<p>So, unfortunately networkD3 does not play nicely directly with tidygraph so we need to do some finagling. First we need to convert our tidygraph object to a network d3 object using <code>igraph_to_networkD3()</code>. In order to specify the group each nodes belongs in we need to extract a named vector to specify the <code>group</code> argument. Then we need to create our JavaScript color scale.</p>
<pre class="r"><code># 1. Make the named vector that specifies which group each node belongs to

## extract our nodes from tidygraph as a data frame
group_information &lt;- hs_manipulated %&gt;% 
  activate(nodes) %&gt;% 
  as_tibble() 

## create a named vector with node names and the group they belong to
node_vec &lt;- as.numeric(group_information[[&quot;name&quot;]])
group_vec &lt;- as.numeric(group_information[[&quot;components&quot;]])

group_info &lt;- set_names(x = group_vec, nm = node_vec)

# 2. Convert igraph to list for networkD3
d3_object &lt;- igraph_to_networkD3(hs_manipulated, group = group_info)


# 3. Set the colors for d3 orange and blue for now
ColourScale &lt;- &#39;d3.scaleOrdinal()
            .domain([&quot;1&quot;, &quot;2&quot;])
           .range([&quot;#FF6900&quot;, &quot;#89cff0&quot;]);&#39;



# 4. Plot as a forceDirected Network
forceNetwork(Links = d3_object$links, 
             Nodes = d3_object$nodes, 
             Source = &#39;source&#39;,
             Target = &#39;target&#39;, 
             NodeID = &#39;name&#39;, 
             Group = &#39;group&#39;,
             colourScale = JS(ColourScale),
             zoom = TRUE)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"links":{"source":[28,17,16,18,8,5,26,0,7,0,2,16,38,17,7,11,6,3,24,14,17,16,4,3,9,8,13,5,10,20,11,12,20,0,18,48,1,35,11,10,8,48,10,18,19,11,8,1,35,5,12,29,17,36,36,32,45,65,34,23,33,33,29,43,36,37,27,23,39,23,30,28,24,37,25,20,18,26,43,56,25,31,17,23,21,34,24,28,40,39,23,14,30,23,33,38,30,40,21,14,38,30,33,4,3,29,39,44,51,54,52,31,36,41,47,49,44,32,49,27,54,52,51,42,3,9,45,21,49,50,19,20,35,22,8,21,45,47,9,50,44,49,21,44,9,45,47,43,56,42,19,0,52,46,35,56,54,19,42,46,0,51,42,57,58,36,43,18,62,59,21,57,55,65,21,62,57,29,65,66,51,67,68,64,63,68,53,64,66,59,65,55,21,57,58,60,67,68,66,54,64,61,66,63,61,67,68,60,38,47,62,21,39,49,40,68,61,60,63,64,51,67,15,53,48,46,68,63,54,60,42,51,54,46,53,66,60,64,67,61,63,15,2],"target":[69,9,9,10,10,11,11,12,12,13,13,14,14,14,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,23,24,25,26,27,27,28,28,29,29,30,30,31,31,32,32,32,33,33,33,34,34,34,35,35,35,35,36,36,36,36,3,37,37,37,37,37,38,38,38,38,38,39,39,39,39,39,40,40,40,40,40,40,40,40,40,41,42,42,42,43,43,44,44,44,45,45,45,45,46,46,46,46,4,47,47,47,47,47,48,48,48,48,48,49,49,49,49,49,49,50,50,50,50,50,50,51,51,51,51,51,51,51,52,52,52,52,52,52,52,52,54,55,55,56,56,5,57,57,57,58,58,58,59,59,59,59,59,60,60,60,60,60,61,61,61,61,61,62,62,62,62,62,62,63,63,63,63,63,63,63,64,64,64,64,64,64,65,65,65,65,65,65,65,66,66,66,66,66,66,66,6,67,67,67,67,67,67,67,67,68,68,68,68,68,68,68,68,68,68,7,8],"colour":["#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["1","2","3","4","5","6","7","8","9","11","12","13","14","15","16","17","18","19","20","21","22","23","24","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","10"],"group":[1,1,1,2,2,1,1,1,1,2,1,1,1,1,2,1,2,2,1,1,1,2,1,2,2,1,1,2,2,2,2,1,2,2,2,1,1,2,2,2,2,2,1,1,2,2,1,2,1,2,2,1,1,1,1,2,1,2,2,2,1,1,2,1,1,2,1,1,1,2]},"options":{"NodeID":"name","Group":"group","colourScale":"d3.scaleOrdinal()\n            .domain([\"1\", \"2\"])\n           .range([\"#FF6900\", \"#89cff0\"]);","fontSize":7,"fontFamily":"serif","clickTextSize":17.5,"linkDistance":50,"linkWidth":"function(d) { return Math.sqrt(d.value); }","charge":-30,"opacity":0.6,"zoom":true,"legend":false,"arrows":false,"nodesize":false,"radiusCalculation":" Math.sqrt(d.nodesize)+6","bounded":false,"opacityNoHover":0,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
<p>We will leave it there for now.</p>
</div>

</div>

        <footer class="post-footer clearfix">
    
        <p class="post-tags">
            <span>Tagged:</span>
            
            
                <a href="../../../../tags/rstats/">rstats</a>, 
            
                <a href="../../../../tags/network-analysis/">network analysis</a>, 
            
                <a href="../../../../tags/tidygraph/">tidygraph</a>
            
        </p>
    

    <div class="share">
        

        

        
        
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="The Joy of Analysis" href="../../../../">The Joy of Analysis</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2020 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="../../../../js/jquery-1.11.3.min.js"></script>
        <script src="../../../../js/jquery.fitvids.js"></script>
        
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        
        
        <script src="../../../../js/scripts.js"></script>
    </body>
</html>

